function bencode(c){switch(c.constructor){case Boolean:return"i"+parseInt(c?1:0)+"e";break;case Number:return"i"+parseInt(c)+"e";break;case Date:return"i"+Math.floor(c.valueOf()/1000)+"e";break;case Array:var a=new BlobBuilder();a.append("l");for(var d=0;d<c.length;d++){a.append(bencode(c[d]))}a.append("e");return a.getBlob();break;case Object:var a=new BlobBuilder();a.append("d");for(var e in c){if(!c.hasOwnProperty(e)){continue}a.append(bencode(String(e)));a.append(bencode(c[e]))}a.append("e");return a.getBlob();break;case Blob:var b=new BlobBuilder();b.append(c.size.toString());b.append(":");b.append(c);return b.getBlob();break;case String:default:var f=c.toString();return f.length+":"+f;break}}(function(a){a.torrent=function(c,b){var d=this;b=b||{};d.$el=a(c);d.el=c;d.hashedPieces=[];d.$el.data("torrent",d);d.init=function(){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;Blob.prototype.slice=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;if(b.torrent){b.torrent=a.extend(true,a.torrent.defaultOptions.torrent,b.torrent)}d.options=a.extend({},a.torrent.defaultOptions,b)};d.hexToBlob=function(f){var e=new Uint8Array(Math.ceil(f.length/2));for(var g=0;g<f.length;g+=2){e[Math.ceil(g/2)]=parseInt(f.substr(g,2),16)}var h=new BlobBuilder();h.append(e.buffer);return h.getBlob()};d.beginCreateTorrent=function(f){var e=d.options.torrent.info;delete e.files;delete e.length;e.pieces=[];if(!this.el.files){throw"wrong_element"}if(this.el.files.length==0){throw"no_files"}var p=0;var h=e["piece length"];for(var n=0,g;g=d.el.files[n];++n){if(d.el.files.length>1){if(typeof e.files=="undefined"){e.files=[]}e.files[n]={length:g.size,path:[g.name]}}else{e.length=g.size;e.name=(a.torrent.defaultOptions.torrent.info.name==e.name)?d.el.files[0].name:e.name}p+=Math.ceil(g.size/h)}var m=0;var k=0;for(var l=0,g;g=d.el.files[l];++l){m=0;var o=g.slice(m,h);while(o.size>0){(function(q,j){var i=function(){var r=new FileReader();r.onloadend=function(u){var t=Sha1.hash(u.target.result,false);e.pieces[j]=d.hexToBlob(t);var s=function(v){var x=0;for(var w in v){x++}return x}(e.pieces);d.onProgressChanged.call(this,{done:s,all:p});d.$el.dequeue()};r.readAsBinaryString(q)};d.$el.queue(i)})(o,k);m+=h;o=g.slice(m,m+h);k++}}};d.onProgressChanged=function(k){d.options.onProgressChanged.call(this,k);var j=d.options.torrent;if(k.done==k.all){var h=new BlobBuilder();for(var f=0,g;g=j.info.pieces[f];f++){h.append(g)}j.info.pieces=h.getBlob();d.options.onTorrentCreated.call(this,bencode(j))}};d.init()};a.torrent.defaultOptions={torrent:{info:{name:"Torrent","piece length":1048576,pieces:[]}},onProgressChanged:function(){},onTorrentCreated:function(){},onError:function(){}};a.fn.torrent=function(b){return this.each(function(){(new a.torrent(this,b))})};a.fn.gettorrent=function(){return this.data("torrent")}})(jQuery);var Sha1={};Sha1.hash=function(h,z){z=(typeof z=="undefined")?true:z;if(z){h=Utf8.encode(h)}var n=[1518500249,1859775393,2400959708,3395469782];h+=String.fromCharCode(128);var x=h.length/4+2;var k=Math.ceil(x/16);var m=new Array(k);for(var A=0;A<k;A++){m[A]=new Array(16);for(var y=0;y<16;y++){m[A][y]=(h.charCodeAt(A*64+y*4)<<24)|(h.charCodeAt(A*64+y*4+1)<<16)|(h.charCodeAt(A*64+y*4+2)<<8)|(h.charCodeAt(A*64+y*4+3))}}m[k-1][14]=((h.length-1)*8)/Math.pow(2,32);m[k-1][14]=Math.floor(m[k-1][14]);m[k-1][15]=((h.length-1)*8)&4294967295;var u=1732584193;var r=4023233417;var q=2562383102;var p=271733878;var o=3285377520;var f=new Array(80);var F,E,D,C,B;for(var A=0;A<k;A++){for(var v=0;v<16;v++){f[v]=m[A][v]}for(var v=16;v<80;v++){f[v]=Sha1.ROTL(f[v-3]^f[v-8]^f[v-14]^f[v-16],1)}F=u;E=r;D=q;C=p;B=o;for(var v=0;v<80;v++){var w=Math.floor(v/20);var g=(Sha1.ROTL(F,5)+Sha1.f(w,E,D,C)+B+n[w]+f[v])&4294967295;B=C;C=D;D=Sha1.ROTL(E,30);E=F;F=g}u=(u+F)&4294967295;r=(r+E)&4294967295;q=(q+D)&4294967295;p=(p+C)&4294967295;o=(o+B)&4294967295}return Sha1.toHexStr(u)+Sha1.toHexStr(r)+Sha1.toHexStr(q)+Sha1.toHexStr(p)+Sha1.toHexStr(o)};Sha1.f=function(b,a,d,c){switch(b){case 0:return(a&d)^(~a&c);case 1:return a^d^c;case 2:return(a&d)^(a&c)^(d&c);case 3:return a^d^c}};Sha1.ROTL=function(a,b){return(a<<b)|(a>>>(32-b))};Sha1.toHexStr=function(d){var c="",a;for(var b=7;b>=0;b--){a=(d>>>(b*4))&15;c+=a.toString(16)}return c};var Utf8={};Utf8.encode=function(a){var b=a.replace(/[\u0080-\u07ff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(192|d>>6,128|d&63)});b=b.replace(/[\u0800-\uffff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(224|d>>12,128|d>>6&63,128|d&63)});return b};Utf8.decode=function(b){var a=b.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var d=((e.charCodeAt(0)&15)<<12)|((e.charCodeAt(1)&63)<<6)|(e.charCodeAt(2)&63);return String.fromCharCode(d)});a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var d=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(d)});return a};